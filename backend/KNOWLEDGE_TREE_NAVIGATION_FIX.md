# Knowledge Tree å¯¼èˆªä¿®å¤

## ğŸ› é—®é¢˜æè¿°

### é—®é¢˜ 1: "No course ID provided" é”™è¯¯

**ç°è±¡ï¼š**
- ç”¨æˆ·ä» Courses é¡µé¢ç‚¹å‡» "Study" æŒ‰é’®
- è·³è½¬åˆ° CourseDetail é¡µé¢
- ç‚¹å‡»ç¡®è®¤æŒ‰é’®ï¼ˆStart Learningï¼‰
- è¿›å…¥ Knowledge Tree é¡µé¢
- **æ˜¾ç¤ºé”™è¯¯**ï¼š`Failed to load course - No course ID provided`

**åŸå› ï¼š**
`CourseDetail.tsx` çš„ `handleConfirm` å‡½æ•°ä¸­ä½¿ç”¨äº†æœªå®šä¹‰çš„å˜é‡ `courseMapId`ï¼š

```typescript
// âŒ é”™è¯¯ä»£ç 
const handleConfirm = () => {
  navigate(buildLearningPath('/knowledge-tree', { cid: courseMapId })); // courseMapId ä¸å­˜åœ¨ï¼
};
```

åº”è¯¥ä½¿ç”¨ `cidFromUrl`ï¼ˆä» URL å‚æ•°è¯»å–çš„å€¼ï¼‰ã€‚

---

### é—®é¢˜ 2: æ— æ³•åœ¨å­¦ä¹ é¡µé¢åˆ‡æ¢è¯¾ç¨‹

**éœ€æ±‚ï¼š**
- ç”¨æˆ·åœ¨ Knowledge Tree é¡µé¢å­¦ä¹ æ—¶
- æƒ³åˆ‡æ¢åˆ°å…¶ä»–è¯¾ç¨‹
- æœŸæœ›ï¼šåœ¨è¯¾ç¨‹å¡ç‰‡ä¸Šæœ‰å·¦å³ç®­å¤´ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢
- ç°çŠ¶ï¼šå¿…é¡»è¿”å›ä¸»é¡µå†é€‰æ‹©

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: ä¿®æ­£ CourseDetail å¯¼èˆª

```typescript
// âœ… ä¿®å¤å
const handleConfirm = () => {
  localStorage.setItem('evo_onboarding_completed', 'true');
  navigate(buildLearningPath('/knowledge-tree', { cid: cidFromUrl })); // ä½¿ç”¨æ­£ç¡®çš„å˜é‡
};
```

---

### ä¿®å¤ 2: æ·»åŠ è¯¾ç¨‹åˆ‡æ¢åŠŸèƒ½

#### 1. åŠ è½½æ‰€æœ‰ç”¨æˆ·è¯¾ç¨‹

```typescript
// åœ¨ KnowledgeTree ç»„ä»¶ä¸­
const [allCourses, setAllCourses] = useState<CourseListItem[]>([]);
const [currentCourseIndex, setCurrentCourseIndex] = useState<number>(0);

useEffect(() => {
  // åŠ è½½æ‰€æœ‰è¯¾ç¨‹
  const coursesData = await getUserCourses();
  setAllCourses(coursesData.courses);
  
  // æ‰¾åˆ°å½“å‰è¯¾ç¨‹çš„ç´¢å¼•
  const currentIndex = coursesData.courses.findIndex(
    (c) => c.course_map_id === cidFromUrl
  );
  setCurrentCourseIndex(currentIndex);
}, [cidFromUrl]);
```

#### 2. æ·»åŠ åˆ‡æ¢å‡½æ•°

```typescript
const handlePreviousCourse = () => {
  if (currentCourseIndex > 0 && allCourses.length > 0) {
    const prevCourse = allCourses[currentCourseIndex - 1];
    navigate(buildLearningPath('/knowledge-tree', { cid: prevCourse.course_map_id }));
  }
};

const handleNextCourse = () => {
  if (currentCourseIndex < allCourses.length - 1 && allCourses.length > 0) {
    const nextCourse = allCourses[currentCourseIndex + 1];
    navigate(buildLearningPath('/knowledge-tree', { cid: nextCourse.course_map_id }));
  }
};
```

#### 3. UI è®¾è®¡

**æ¨ªå¹…å¸ƒå±€ï¼š**
```
[â†ç®­å¤´] [è¯¾ç¨‹æ ‡é¢˜ + è¿›åº¦æ¡] [â†’ç®­å¤´]
        [å½“å‰/æ€»æ•°: 2/5]
```

**ç‰¹æ€§ï¼š**
- å·¦ç®­å¤´ï¼šåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªè¯¾ç¨‹ï¼ˆç¬¬ä¸€ä¸ªè¯¾ç¨‹æ—¶éšè—ï¼‰
- å³ç®­å¤´ï¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè¯¾ç¨‹ï¼ˆæœ€åä¸€ä¸ªè¯¾ç¨‹æ—¶éšè—ï¼‰
- å½“å‰ä½ç½®æ˜¾ç¤ºï¼š`2 / 5`ï¼ˆåªæœ‰å¤šä¸ªè¯¾ç¨‹æ—¶æ˜¾ç¤ºï¼‰
- å•ä¸ªè¯¾ç¨‹æ—¶ï¼šç®­å¤´å®Œå…¨éšè—

---

## ğŸ¨ UI æ•ˆæœ

### å•ä¸ªè¯¾ç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚
â”‚   å®¹å™¨é›†ç¾¤æ·±åº¦è°ƒä¼˜å®æˆ˜          â”‚
â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 65% DONE       â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤šä¸ªè¯¾ç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†   Python åŸºç¡€å…¥é—¨   â†’      â”‚
â”‚      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 45% DONE    â”‚
â”‚          2 / 5                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’ï¼š**
- ç‚¹å‡» â† åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªè¯¾ç¨‹
- ç‚¹å‡» â†’ åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè¯¾ç¨‹
- ç‚¹å‡»ä¸­é—´åŒºåŸŸè¿›å…¥è¯¾ç¨‹è¯¦æƒ…é¡µ
- å¹³æ»‘åˆ‡æ¢ï¼Œä¿æŒåœ¨ Knowledge Tree é¡µé¢

---

## ğŸ“Š è¯¾ç¨‹æ’åº

è¯¾ç¨‹æŒ‰**åˆ›å»ºæ—¶é—´å€’åº**æ’åˆ—ï¼ˆä¸ä¸»é¡µä¸€è‡´ï¼‰ï¼š
- æœ€æ–°åˆ›å»ºçš„è¯¾ç¨‹åœ¨å‰
- æœ€æ—©åˆ›å»ºçš„è¯¾ç¨‹åœ¨å
- ç®­å¤´åˆ‡æ¢æŒ‰æ­¤é¡ºåº

ç¤ºä¾‹ï¼š
```
[æ–°] è¯¾ç¨‹3 â† â†’ è¯¾ç¨‹2 â† â†’ è¯¾ç¨‹1 [æ—§]
```

---

## ğŸ”„ ç”¨æˆ·æµç¨‹

### æµç¨‹ 1: æ­£å¸¸å­¦ä¹ æµç¨‹
```
Courses é¡µé¢ â†’ ç‚¹å‡»è¯¾ç¨‹
    â†“
CourseDetail é¡µé¢ â†’ ç‚¹å‡» "Start Learning"
    â†“
Knowledge Tree é¡µé¢ âœ… (æ­£ç¡®æ˜¾ç¤º)
```

### æµç¨‹ 2: åœ¨å­¦ä¹ ä¸­åˆ‡æ¢è¯¾ç¨‹
```
Knowledge Tree (è¯¾ç¨‹ A)
    â†“
ç‚¹å‡»å³ç®­å¤´ â†’
    â†“
Knowledge Tree (è¯¾ç¨‹ B) âœ… (å¿«é€Ÿåˆ‡æ¢)
```

### æµç¨‹ 3: å¤šè¯¾ç¨‹å¾ªç¯æµè§ˆ
```
è¯¾ç¨‹ 1 â†’ è¯¾ç¨‹ 2 â†’ è¯¾ç¨‹ 3
   â†‘                    â†“
   â””â”€â”€â”€â”€â”€â”€â† è¿”å› â†â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯• 1: å•ä¸ªè¯¾ç¨‹
```bash
1. ç”¨æˆ·åªæœ‰ 1 ä¸ªè¯¾ç¨‹
2. è¿›å…¥ Knowledge Tree
3. âœ… éªŒè¯ï¼šç®­å¤´ä¸æ˜¾ç¤ºï¼ˆopacity-0ï¼‰
4. âœ… éªŒè¯ï¼šä¸æ˜¾ç¤º "1/1" è®¡æ•°
```

### æµ‹è¯• 2: å¤šä¸ªè¯¾ç¨‹åˆ‡æ¢
```bash
1. åˆ›å»º 3 ä¸ªè¯¾ç¨‹ï¼ˆA, B, Cï¼‰
2. è¿›å…¥è¯¾ç¨‹ B çš„ Knowledge Tree
3. âœ… éªŒè¯ï¼šæ˜¾ç¤º "2 / 3"
4. ç‚¹å‡»å·¦ç®­å¤´ â†’ åˆ‡æ¢åˆ°è¯¾ç¨‹ A
5. âœ… éªŒè¯ï¼šæ˜¾ç¤º "1 / 3"ï¼Œå·¦ç®­å¤´éšè—
6. ç‚¹å‡»å³ç®­å¤´ â†’ åˆ‡æ¢å›è¯¾ç¨‹ B
7. âœ… éªŒè¯ï¼šæ˜¾ç¤º "2 / 3"ï¼Œä¸¤ä¸ªç®­å¤´éƒ½æ˜¾ç¤º
```

### æµ‹è¯• 3: è¾¹ç•Œæƒ…å†µ
```bash
1. åœ¨ç¬¬ä¸€ä¸ªè¯¾ç¨‹
2. âœ… éªŒè¯ï¼šå·¦ç®­å¤´éšè—
3. åœ¨æœ€åä¸€ä¸ªè¯¾ç¨‹
4. âœ… éªŒè¯ï¼šå³ç®­å¤´éšè—
```

### æµ‹è¯• 4: ä¿®å¤éªŒè¯
```bash
1. ä» Courses é¡µé¢ç‚¹å‡»è¯¾ç¨‹
2. è¿›å…¥ CourseDetail
3. ç‚¹å‡» "Start Learning"
4. âœ… éªŒè¯ï¼šæ­£ç¡®è¿›å…¥ Knowledge Treeï¼Œæ— é”™è¯¯
5. âœ… éªŒè¯ï¼šæ˜¾ç¤ºè¯¾ç¨‹æ ‡é¢˜å’Œè¿›åº¦
```

---

## ğŸ¯ ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¯´æ˜ |
|------|---------|------|
| **CourseDetail.tsx** | ä¿®å¤å˜é‡å | `courseMapId` â†’ `cidFromUrl` |
| **KnowledgeTree.tsx** | æ·»åŠ è¯¾ç¨‹åˆ‡æ¢ | å·¦å³ç®­å¤´ + åˆ‡æ¢é€»è¾‘ |

---

## ğŸ¨ è®¾è®¡ç»†èŠ‚

### ç®­å¤´æŒ‰é’®æ ·å¼
```css
- èƒŒæ™¯ï¼šç™½è‰²åŠé€æ˜ (bg-white/20)
- Hoverï¼šæ›´äº® (bg-white/30)
- ç‚¹å‡»ï¼šç¼©æ”¾åŠ¨ç”» (active:scale-90)
- ç¦ç”¨ï¼šå®Œå…¨é€æ˜ (opacity-0) + ä¸å¯ç‚¹å‡»
```

### è¯¾ç¨‹è®¡æ•°æ ·å¼
```css
- å­—ä½“ï¼š10px, ç²—ä½“
- é€æ˜åº¦ï¼š60%
- ä½ç½®ï¼šè¿›åº¦æ¡ä¸‹æ–¹
- æ˜¾ç¤ºæ¡ä»¶ï¼šè¯¾ç¨‹æ•° > 1
```

### å“åº”å¼å¸ƒå±€
```css
- å·¦ç®­å¤´ï¼šz-10, å›ºå®šå·¦ä¾§
- å†…å®¹åŒºï¼šflex-1, å±…ä¸­, å¯ç‚¹å‡»
- å³ç®­å¤´ï¼šz-10, å›ºå®šå³ä¾§
- è£…é¥°å…ƒç´ ï¼šç»å¯¹å®šä½, ä½é€æ˜åº¦
```

---

## ğŸ“± ç”¨æˆ·ä½“éªŒæå‡

### Before âŒ
- åˆ‡æ¢è¯¾ç¨‹å¿…é¡»è¿”å›ä¸»é¡µ
- æµç¨‹ä¸­æ–­ï¼Œä½“éªŒä¸è¿è´¯
- éœ€è¦ 3 æ¬¡ç‚¹å‡»ï¼šè¿”å› â†’ é€‰è¯¾ç¨‹ â†’ è¿›å…¥

### After âœ…
- åœ¨å­¦ä¹ é¡µé¢ç›´æ¥åˆ‡æ¢
- æµç¨‹è¿è´¯ï¼Œæ— ä¸­æ–­
- åªéœ€ 1 æ¬¡ç‚¹å‡»ï¼šç‚¹å‡»ç®­å¤´

---

## ğŸ” å®ç°ç»†èŠ‚

### ç®­å¤´æ˜¾ç¤ºé€»è¾‘

```typescript
// å·¦ç®­å¤´ï¼šå½“å‰ä¸æ˜¯ç¬¬ä¸€ä¸ª && æœ‰å¤šä¸ªè¯¾ç¨‹æ—¶æ˜¾ç¤º
disabled={currentCourseIndex === 0 || allCourses.length <= 1}

// å³ç®­å¤´ï¼šå½“å‰ä¸æ˜¯æœ€åä¸€ä¸ª && æœ‰å¤šä¸ªè¯¾ç¨‹æ—¶æ˜¾ç¤º
disabled={currentCourseIndex === allCourses.length - 1 || allCourses.length <= 1}
```

### åˆ‡æ¢é€»è¾‘

```typescript
// åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ª
handlePreviousCourse() {
  const prevCourse = allCourses[currentCourseIndex - 1];
  navigate('/knowledge-tree?cid=' + prevCourse.course_map_id);
}

// åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª
handleNextCourse() {
  const nextCourse = allCourses[currentCourseIndex + 1];
  navigate('/knowledge-tree?cid=' + nextCourse.course_map_id);
}
```

### è‡ªåŠ¨æ›´æ–°

- å½“ URL å‚æ•° `cid` å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨é‡æ–°åŠ è½½è¯¾ç¨‹æ•°æ®
- `useEffect` ä¾èµ– `[cidFromUrl]`
- åˆ‡æ¢åè‡ªåŠ¨åŠ è½½æ–°è¯¾ç¨‹çš„èŠ‚ç‚¹å’Œè¿›åº¦

---

## ğŸš€ æ€§èƒ½è€ƒè™‘

### API è°ƒç”¨ä¼˜åŒ–

**å½“å‰å®ç°ï¼š**
- æ¯æ¬¡åŠ è½½ Knowledge Tree æ—¶è°ƒç”¨ `getUserCourses()`
- è·å–æ‰€æœ‰è¯¾ç¨‹åˆ—è¡¨ï¼ˆç”¨äºå¯¼èˆªï¼‰

**åç»­ä¼˜åŒ–æ–¹å‘ï¼š**
1. ä½¿ç”¨ React Query ç¼“å­˜è¯¾ç¨‹åˆ—è¡¨
2. åªåœ¨ä¸»é¡µåŠ è½½ä¸€æ¬¡ï¼Œé€šè¿‡ Context å…±äº«
3. æ·»åŠ è¯¾ç¨‹é¢„åŠ è½½ï¼ˆåˆ‡æ¢å‰é¢„åŠ è½½ä¸‹ä¸€ä¸ªè¯¾ç¨‹ï¼‰

### åŠ è½½çŠ¶æ€

```
ç”¨æˆ·ç‚¹å‡»ç®­å¤´
    â†“
æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼ˆKnowledge Tree çš„ isLoadingï¼‰
    â†“
åŠ è½½æ–°è¯¾ç¨‹æ•°æ® + èŠ‚ç‚¹è¿›åº¦
    â†“
æ¸²æŸ“æ–°çš„ DAG
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æ­£ç¡®æ€§
- [x] ä» Courses é¡µé¢è¿›å…¥ Knowledge Tree æ— é”™è¯¯
- [x] å•ä¸ªè¯¾ç¨‹æ—¶ç®­å¤´éšè—
- [x] å¤šä¸ªè¯¾ç¨‹æ—¶ç®­å¤´æ­£ç¡®æ˜¾ç¤º/éšè—
- [x] ç‚¹å‡»ç®­å¤´æ­£ç¡®åˆ‡æ¢è¯¾ç¨‹
- [x] åˆ‡æ¢ååŠ è½½æ­£ç¡®çš„èŠ‚ç‚¹å’Œè¿›åº¦
- [x] æ˜¾ç¤ºå½“å‰è¯¾ç¨‹ä½ç½®ï¼ˆå¦‚ 2/5ï¼‰

### UI ç¾è§‚æ€§
- [x] ç®­å¤´ä¸æ¨ªå¹…é£æ ¼ç»Ÿä¸€
- [x] Hover æ•ˆæœæµç•…
- [x] ç‚¹å‡»åŠ¨ç”»è‡ªç„¶
- [x] ç¦ç”¨çŠ¶æ€å¹³æ»‘è¿‡æ¸¡ï¼ˆæ·¡å‡ºï¼‰

### æ€§èƒ½
- [x] åˆ‡æ¢å“åº”åŠæ—¶
- [x] æ— ä¸å¿…è¦çš„ API è°ƒç”¨
- [x] Loading çŠ¶æ€æ¸…æ™°

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

**ä¿®å¤å®Œæˆæ—¥æœŸ**: 2026-02-07  
**ä¿®å¤ç±»å‹**: Bugä¿®å¤ + åŠŸèƒ½å¢å¼º  
**å½±å“èŒƒå›´**: 
- ä¿®å¤å¯¼èˆªé”™è¯¯
- æ·»åŠ è¯¾ç¨‹åˆ‡æ¢åŠŸèƒ½
- æå‡ç”¨æˆ·ä½“éªŒ

---

## ğŸ§ª å»ºè®®æµ‹è¯•æ­¥éª¤

1. **åŸºç¡€åŠŸèƒ½æµ‹è¯•**
   ```
   Courses â†’ ç‚¹å‡»è¯¾ç¨‹ â†’ CourseDetail â†’ Start â†’ Knowledge Tree
   âœ… åº”è¯¥æ­£å¸¸æ˜¾ç¤ºï¼Œæ— é”™è¯¯
   ```

2. **å•è¯¾ç¨‹åœºæ™¯**
   ```
   åªæœ‰ 1 ä¸ªè¯¾ç¨‹ â†’ è¿›å…¥ Knowledge Tree
   âœ… ç®­å¤´ä¸æ˜¾ç¤º
   ```

3. **å¤šè¯¾ç¨‹åˆ‡æ¢**
   ```
   æœ‰ 3 ä¸ªè¯¾ç¨‹ â†’ è¿›å…¥ä¸­é—´è¯¾ç¨‹
   âœ… æ˜¾ç¤º "2/3"
   âœ… ä¸¤ä¸ªç®­å¤´éƒ½æ˜¾ç¤º
   ç‚¹å‡»å·¦ç®­å¤´ â†’ åˆ‡æ¢åˆ°è¯¾ç¨‹ 1
   âœ… æ˜¾ç¤º "1/3"
   âœ… å·¦ç®­å¤´éšè—
   ```

4. **è¾¹ç•Œæµ‹è¯•**
   ```
   åœ¨ç¬¬ä¸€ä¸ªè¯¾ç¨‹ â†’ ç‚¹å‡»å·¦ç®­å¤´
   âœ… æ— ååº”ï¼ˆå·²ç¦ç”¨ï¼‰
   åœ¨æœ€åä¸€ä¸ªè¯¾ç¨‹ â†’ ç‚¹å‡»å³ç®­å¤´
   âœ… æ— ååº”ï¼ˆå·²ç¦ç”¨ï¼‰
   ```
